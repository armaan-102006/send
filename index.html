<!DOCTYPE html>
<html>
<head><title>Send My Location</title></head>
<body>
<button onclick="start()">Start Sending Location</button>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
let socket, watchId;

function start() {
  navigator.permissions.query({name:'geolocation'}).then(function(result) {
    if (result.state === 'granted' || result.state === 'prompt') {
      startWatchPosition();
    } else if (result.state === 'denied') {
      alert('Geolocation permission denied. Please enable it manually.');
    }

    result.onchange = function() {
      if (result.state === 'granted') {
        startWatchPosition();
      }
    };
  });
}

function startWatchPosition() {
  socket = io('http://366c7cb5c730.ngrok-free.app/bus:5000'); 

  socket.on('connect', () => {
    watchId = navigator.geolocation.watchPosition(
      (pos) => {
        socket.emit('location', {
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
          accuracy: pos.coords.accuracy,
          speed: pos.coords.speed
        });
      },
      (err) => {
        console.error('Geolocation error:', err);
      },
      { enableHighAccuracy: true }
    );
  });

  socket.on('disconnect', () => {
    if (watchId) navigator.geolocation.clearWatch(watchId);
  });
}
</script>

</body>
</html>










